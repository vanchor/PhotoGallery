@page "/"

<PageTitle>Index</PageTitle>

<AuthorizeView>
    <Authorized>
        <div class="col-6">
            <div class="form-group">
                <InputFile OnChange="OnInputFileChange" />
                <button class="btn btn-sm btn-success" type="button"
                        @onclick="UploadFile">
                    Upload
                </button>

                <br />
                <br />
            </div>
            <br />
            <label>@labelText</label>
        </div>

        @if (previewImage is not null)
        {
            <div class="card">
                <div class="row align-items-start">
                    <div class="col-2">
                        <img class="rounded float-left" src="@previewImage" width="100" height="100" />

                    </div>
                </div>
            </div>
        }
    </Authorized>
    <NotAuthorized>
        <h2>You must be authorized</h2>
    </NotAuthorized>
</AuthorizeView>

@code {
    private string previewImage;

    private IBrowserFile selectedFile;

    private string labelText = "";

    private async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        var file = e.GetMultipleFiles()[0];
        var resizedImage = await file.RequestImageFileAsync(file.ContentType, 100, 100);
        var buffer = new byte[resizedImage.Size];
        await resizedImage.OpenReadStream().ReadAsync(buffer);

        var imageUrl = $"data:{file.ContentType};base64,{Convert.ToBase64String(buffer)}";
        previewImage = imageUrl;
    }

    private async Task UploadFile()
    {
        try
        {
            if (selectedFile is not null)
            {
                //await fileUpload.UpLoadFile(selectedFile);
            }
        }
        catch (Exception ex)
        {
            labelText = ex.Message;
        }
    }
}
